<?xml version="1.0" encoding="UTF-8"?>
<!--  $Id: fedoragsearch-config-2.3.xml gertsp $ -->
<project name="FgsConfig" default="configFgs" basedir=".">
	<description>
		Fedora Generic Search Service configuration, 
		simplified for GSearch version 2.3, because relative paths
		are now used in xslt stylesheet includes instead of absolute paths,
		(resolving FCREPO-464, thanks to Renaud Waldura),
		and config.prefix values are not used,
		this applies only to configFgs23.
		Set the property values for your environment.
		Select the default config in configDefault.
		Save this edited file outside of the web server.
		This ant script is run from fedoragsearch-config-2.3.sh:
					>ant -f fedoragsearch-config-2.3.xml configFgs
	</description>

	<property file="fedoragsearch-config-2.3-input.properties" />

	<target name="prepForWebServer"
        	description="set values for the configs on web server">
		<property name="webserver.path" location="${fedora.home}/tomcat" />
		<path id="config.path">
			<pathelement path="${webserver.path}/webapps/fedoragsearch/WEB-INF/classes"/>
		</path>
		<pathconvert targetos="unix" property="configs.path" refid="config.path"/>		
	</target>

	<target name="prepForLocalDevelopment"
        	description="set values for the local development configs">
		<property name="config.path" location="../FgsBuild/webapp/WEB-INF/classes" />
	</target>

	<target name="configFgs"
        	description="insert config values into config files">

		<property name="fgs.config.name" value="config" />
		<property name="default.config.name" value="configFgs23" />
		<property name="fgs.config.path" value="${config.path}/${fgs.config.name}" />
		
		<delete dir="${fgs.config.path}" />
		<mkdir dir="${fgs.config.path}" />
		<copy todir="${fgs.config.path}">
			<fileset dir="${config.path}/${default.config.name}"/>
		</copy>
		
		<property name="fgs.mimetypes" value="text/plain text/xml text/html application/xml application/pdf" />
		<property name="fgs.index.1" value="Fgs23Index" />
		<property name="fgs.index.1.indexdir" value="${fedora.home}/gsearch/${fgs.index.1}" />
		<property name="fgs.index.1.stopwords" value="${fedora.home}/gsearch/stopwords.txt" />
		<property name="fgs.index.names" value="${fgs.index.1}" />
		<property name="fgs.repos.1" value="Fgs23Repos" />
		<property name="fgs.repos.1.fedorabase" value="http://localhost:8080" />
		<property name="fgs.repos.1.fedorauser" value="fedoraAdmin" />
		<property name="fgs.repos.1.fedorapass" value="fedoraAdmin" />
		<property name="fgs.repos.1.fedoraobjectdir" value="${fedora.home}/${objects.path}" />
		<property name="fgs.repos.1.fedoraversion" value="${fedora.version}" />
		<property name="fgs.repos.names" value="${fgs.repos.1}" />
		
		<replace file="${fgs.config.path}/fedoragsearch.properties" token="SOAPHOSTPORT" value="${soap.deploy.hostport}"/>
		<replace file="${fgs.config.path}/fedoragsearch.properties" token="SOAPUSER" value="${soap.deploy.user}"/>
		<replace file="${fgs.config.path}/fedoragsearch.properties" token="SOAPPASS" value="${soap.deploy.pass}"/>
		<replace file="${fgs.config.path}/fedoragsearch.properties" token="CONFIGPATH" value="${fgs.config.path}"/>
		<replace file="${fgs.config.path}/fedoragsearch.properties" token="REPOSNAMES" value="${fgs.repos.names}"/>
		<replace file="${fgs.config.path}/fedoragsearch.properties" token="INDEXNAMES" value="${fgs.index.names}"/>
		<replace file="${fgs.config.path}/fedoragsearch.properties" token="MIMETYPES" value="${fgs.mimetypes}"/>
		
		<replace file="${fgs.config.path}/rest/gfindObjectsToHtml.xslt" token="REPOS1FEDORABASE" value="${fgs.repos.1.fedorabase}"/>
		
		<replace file="${fgs.config.path}/repository/${fgs.repos.1}/repository.properties" token="FEDORABASE" value="${fgs.repos.1.fedorabase}"/>
		<replace file="${fgs.config.path}/repository/${fgs.repos.1}/repository.properties" token="FEDORAUSER" value="${fgs.repos.1.fedorauser}"/>
		<replace file="${fgs.config.path}/repository/${fgs.repos.1}/repository.properties" token="FEDORAPASS" value="${fgs.repos.1.fedorapass}"/>
		<replace file="${fgs.config.path}/repository/${fgs.repos.1}/repository.properties" token="FEDORAOBJECTDIR" value="${fgs.repos.1.fedoraobjectdir}"/>
		<replace file="${fgs.config.path}/repository/${fgs.repos.1}/repository.properties" token="FEDORAVERSION" value="${fgs.repos.1.fedoraversion}"/>
		
		<replace file="${fgs.config.path}/index/${fgs.index.1}/index.properties" token="INDEXDIR" value="${fgs.index.1.indexdir}"/>
		<replace file="${fgs.config.path}/index/${fgs.index.1}/index.properties" token="STOPWORDSFILE" value="${fgs.index.1.stopwords}"/>
		
	</target>

	<target name="configOnWebServer"
			depends="prepForWebServer, configFgs"
        	description="set values for the configs on web server">
		<replace file="${config.path}/log4j.xml" token="LOGPATH" value="${log.path}"/>
		<replace file="${config.path}/log4j.xml" token="DEBUGLEVELG" value="${log.level}"/>
		<replace file="${config.path}/log4j.xml" token="DEBUGLEVELL" value="${log.level}"/>
		<replace file="${config.path}/log4j.xml" token="DEBUGLEVELS" value="${log.level}"/>
		<replace file="${config.path}/log4j.xml" token="DEBUGLEVELZ" value="${log.level}"/>
	</target>

	<target name="configForLocalDevelopment"
			depends="prepForLocalDevelopment, configFgs"
        	description="set values for the local development configs">
		<property name="debug.level" value="DEBUG" />
		<replace file="${config.path}/log4j.xml" token="LOGPATH" value="${log.path}"/>
		<replace file="${config.path}/log4j.xml" token="DEBUGLEVELG" value="${debug.level}"/>
		<replace file="${config.path}/log4j.xml" token="DEBUGLEVELL" value="${debug.level}"/>
		<replace file="${config.path}/log4j.xml" token="DEBUGLEVELS" value="${debug.level}"/>
		<replace file="${config.path}/log4j.xml" token="DEBUGLEVELZ" value="${debug.level}"/>
	</target>

</project>
