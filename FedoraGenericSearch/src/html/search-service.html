
	<html>
		<head>
			<title>Fedora Generic Search Service</title>
			<link rel="stylesheet" type="text/css" href="css/docstyle.css"/>
			<style type="text/css">
				ol {
				list-style: square outside none;
    			padding-top: 6px;
				}
				ol ol {
				list-style: disc outside none;
    			padding-top: 6px;
				margin-bottom: 10px;
				}
				li.MsoNormal {
				mso-style-parent:"";
				margin-bottom:.0001pt;
				font-size:12.0pt;
				font-family:"Times New Roman";
				margin-left:0in; margin-right:0in; margin-top:0in
				}
			</style>
		</head>
		<body>
			<div id="header">
				<a href="" id="logo"></a>
				<div id="title">
				<h1>Fedora Generic Search Service</h1>
				<h2>for Fedora Release 2.2</h2>
				</div>
			</div>
			<div class="toc">
				<p><b>Table of Contents</b></p>
				<dl>
				<dt><a href="#about">About This Service</a></dt>
				<dt><a href="#installation">Installation</a></dt>
				<dt><a href="#config">Configuration</a></dt>
				<dt><a href="#additional">Additional Information</a></dt>
				</dl>
			</div>
			<div>
			<a name="about"><h2>About This Service</h2></a>
				<p>The Fedora Generic Search Service is part of the 
				<a href="http://www.fedora.info/download/2.1/userdocs/server/features/serviceframework.htm">
				Fedora Service Framework</a>. It was developed by
				<a href="mailto:gsp@dtv.dk">Gert Schmeltz Pedersen</a>
				at the Technical University of Denmark,
				with feedback and contributions from members
				of the Fedora community, including
				Beth Kirschner, Binaya Poudyal, Blake Anderson,
				Boon Low, Christian T&#248;nsberg, 
				Eric Brown,
				Luis Zorita,
				Matthias Razum, 
				Michael Appleby,
				Michael Hoppe,
				Nikolai Schwertner,
				Patrick Monbaron,
				Pierre Yves Landron,
				Robert Sherratt,
				Ryan E. Scherle,
				Sam Liberman, 
				Steve DiDomenico,
				and
				Thierry Michel. </p>
				<p>The work is funded by <a href="http://www.deff.dk">
				DEFF, Denmark's Electronic Research Library</a>.</p>
				<p>The service has the following features:</p>
				<ul>
				<li>Indexing of Fedora FOXML records, 
				including the text contents of datastreams
				and the results of disseminator calls.</li>
				<li>Search in the index.</li>
				<li>Plugin of selected search engines,
				so far 
				<a href="http://lucene.apache.org/">Lucene</a> and
				<a href="http://www.indexdata.dk/zebra/">Zebra</a>.</li>
				</ul>
				<p>The service has been developed and tested on Linux.
				This release targets only Linux installations.
				If you want to use the service on other platforms,
				you may be expert enough to do so, at least several people
				have succeeded in using the prototype on Windows and Mac platforms.
				You are encouraged to share problems and experience with the 
				Fedora community, send mail to 
				<a href="mailto:fedora-users@comm.nsdl.org">fedora-users</a>, or to
				<a href="mailto:cwilper@cs.cornell.edu">Chris Wilper</a>, or to
				<a href="mailto:gsp@dtv.dk">Gert Schmeltz Pedersen</a>.</p>
				<p>The following figure serves to give a first
				understanding for a developer, who will use the 
				Search Service in a Fedora application:
				<p><img src="images/fgs-model.png"/></p>
				<p>The figure shows:</p>
				<ul>
				<li>A REST client, running in a user's browser, which
				may combine accesses to Fedora and to the Search Service.</li>
				<li>A SOAP client, running anywhere, may do the same.</li>
				<li>The Search Service implements a generic set of operations:
				<ul>
					<li><b>updateIndex</b> - indexing the contents of the Fedora repository.</li>
					<li><b>gfindObjects</b> - search similar to Fedora findObjects and to the SRW/SRU operation <b>searchRetrieve</b>.</li>
					<li><b>browseIndex</b> - browsing terms in a given index, similar to the SRW/SRU operation <b>scan</b>.</li>
					<li><b>getRepositoryInfo</b> - describing the properties of a repository,
					<li><b>getIndexInfo</b> - describing the properties of an index.</li>
				</ul>
				</li>
				<li>Engine specific implementations of the operations will receive
				client requests, communicate with the engine indexer and search server,
				and return the responses in the appropriate form to the clients.</li>
				</ul>
				<p>The Search Service may run in a separate
				web server and may index more than one Fedora repository,
				and it may update more than one index in parallel.
				For further architectural details, see 
				<a href="#additional">Additional Information</a></p>
				<p>Fedora version 2.2 does not automatically update the 
				Search Service indexes, this will come with version 2.3.</p>
				
			</div>
			<a name="installation"><h2>Installation</h2></a>
				<p>To install the service:</p>
				<ul>
					<li> <a href="fedoragsearch.war">
				Download the web application (.war) file</a>, which you copy 
				into the webapps directory of your web server, 
				e.g. the tomcat supplied with Fedora, or similar.
				You may rename the .war file, before you copy it
				into the webapps directory, in order to give it another webapp name.</li>
					<li>Edit the configuration settings.</li>
				</ul>
				
				

			<a name="config"><h2>Configuration</h2></a>
				<ul>
					<li>
						Edit the configuration files in 
						.../webapps/&lt;WEBAPPNAME&gt;/WEB-INF/classes/config/
						(where &lt;WEBAPPNAME&gt; by default is 'fedoragsearch'):
						<pre>
fedoragsearch.properties:
	fedoragsearch.soapBase         = http://&lt;HOSTPORT&gt;/&lt;WEBAPPNAME&gt;/services (e.g. http://localhost:8080)
	fedoragsearch.soapUser         = &lt;SOAPUSER&gt;
	fedoragsearch.soapPass         = &lt;SOAPPASSWORD&gt;
	fedoragsearch.deployFile       = &lt;WEBSERVERPATH&gt;/webapps/&lt;WEBAPPNAME&gt;/WEB-INF/classes/config/deploy.wsdd
	fedoragsearch.default&lt;OPERATION&gt;RestXslt = &lt;your default Rest stylesheet for the operation&gt;
	fedoragsearch.mimeTypes        = &lt;a sequence of mimeTypes&gt;
	                                 The first accessible mimeType will decide, 
	                                 which of the datastreams is fetched and indexed.
	                                 Currently "text/plain text/html application/pdf" are implemented.
	fedoragsearch.repositoryNames  = &lt;REPOSNAMES&gt;
	fedoragsearch.indexNames	       = &lt;INDEXNAMES&gt;
	                                 
For each repository:

repository/&lt;REPOSITORYNAME&gt;/repository.properties:
	fgsrepository.soapBase         = http://&lt;HOSTPORT&gt;/fedora/services (e.g. http://localhost:8080)
	fgsrepository.fedoraUser       = &lt;FEDORAUSER&gt;
	fgsrepository.fedoraPass       = &lt;FEDORAPASSWORD&gt;
	fgsrepository.fedoraObjectDir  = &lt;absolute path to FedoraObjects directory with FOXML files&gt;
	fgsrepository.mimeTypes        = &lt;as for fedoragsearch.mimeTypes&gt;
	
For each index:

index/&lt;INDEXNAME&gt;/index.properties:
	fgsindex.indexDir              = &lt;path to Lucene index directory, which must exist&gt;

.../webapps/&lt;WEBAPPNAME&gt;/WEB-INF/classes/log4j.xml:
    &lt;param name="File" value="/&lt;LOGPATH&gt;/&lt;LOGFILENAME&gt;"/&gt; /LOGPATH must exist
						</pre>
						Edit the three files rest/demo*.xslt,
						and the file index/DemoOnLucene/demoFoxmlToLucene.xslt,
						where the xsl:include elements
						shall have absolute paths instead of relative paths.
					</li>
                    <li>
						Then you may restart &lt;WEBAPPNAME&gt; and call http://&lt;HOSTPORT&gt;/&lt;WEBAPPNAME&gt;/rest in order to index and search.
					</li>
                    <li>
						Try the demo command line client. Change directory to 
	<pre>.../webapps/&lt;WEBAPPNAME&gt;/client/</pre>
						make the file executable, and run
	<pre>sh runRESTClient.sh</pre>
						then you will get the usage instruction.
					</li>
                    <li>
						Tailor the demos for your own purpose by editing
						renamed copies of the demo xslt stylesheets in 
	<pre>.../webapps/&lt;WEBAPPNAME&gt;/WEB-INF/classes/config/rest/</pre>
						Then edit fedoragsearch.properties.
					</li>
                    <li>
						Tailor the demo Lucene indexing stylesheet for your own purpose by editing
						a renamed copy of the demo xslt stylesheet in 
	<pre>.../webapps/&lt;WEBAPPNAME&gt;/WEB-INF/classes/config/index/&lt;INDEXNAME&gt;/demoFoxmlToLucene.xslt</pre>
						The options for tailoring include fields from other metadata datastreams 
						than DC, field types and field boosts,
						see the stylesheet for options. Then edit index.properties.
					</li>
                    <li>
						Inspect the Lucene index with <a href="http://www.getopt.org/luke/">Luke</a>.
						Luke cannot open an empty Lucene index.
					</li>
                    <li>You may tailor the highlight of search terms in demo.css.
					</li>
                    <li>You may want to experiment with more than one configuration,
                    in which case you may maintain them under different names
                    in parallel to the &quot;config&quot; configuration, 
                    which is the default configuration.
                    In order to activate an alternative configuration you may use
                    the semi-secret operation configure with parameter configName, 
                    either using the demo command line client or the REST interface. 
					</li>
				</ul>
				
			<a name="additional"><h2>Additional Information</h2></a>
			<div class="toc">
				<dl>
				<dt><a href="#engines">Search Engine Plugins</a></dt>
				<dt><a href="#arch">Architectural Snapshots</a></dt>
				<dt><a href="#multilingual">Multilingual Configuration</a></dt>
				</dl>
			</div>
			<a name="engines"><h3>Search Engine Plugins</h3></a>
				<h4><a href="http://lucene.apache.org/">Lucene</a></h4>
				<p>The Lucene plugin comes as the java package dk.defxws.fgslucene
				together with the Apache Lucene java libraries.
				The set of classes was inspired by the JDBC API specification.</p>
				<p>The Lucene plugin is used by configuration as explained above,
				see also the DemoOnLucene example.</p>
				<p>Lucene has a very rich functionality, and this plugin
				exploits a small fraction of it. As a java programmer, you may
				have ideas for further exploitation, which you may realize
				by implementing an enhanced version of the plugin.
				Please, share such ideas and implementations with the Fedora community.</p>
				<h4><a href="http://www.indexdata.dk/zebra/">Zebra</a></h4>
				<p>The Zebra plugin comes as the java package dk.defxws.fgszebra .</p>
				<p>The Zebra plugin is used by configuration as 
				seen from the DemoOnZebra example, which includes a README file,
				which explains how to get and install Zebra, and how to configure it.</p>
				<p></p>
			<a name="arch"><h3>Architectural Snapshots</h3></a>
				<p><img src="images/fgs-arch.png"/></p>
				<ul>
					<li>
					In the prototype all engine specific operations return 
					an engine specific xml answer, which is transformed 
					by an engine-specific xslt stylesheet into result page xml.
					For a SOAP request this is the answer.
					For a REST request this is transformed to an html answer.
					There may be any number of xslt stylesheets to select from,
					the default ones are selected in the properties file.
					Selecting a copy stylesheet or none will allow the transfer
					of an answer untransformed. An alternative result page format 
					is <a href="http://opensearch.a9.com/">OpenSearch</a>, 
					which is an RSS2.0 extension.
					</li>
					<li>The prototype implementation has parameters to allow clients 
					to select index by name and xslt stylesheets by name. 
					In a real application these values will be determined 
					by the developer in the code,
					or by the administrator in the properties file.
					</li>
					<li>The prototype implementation has OperationsImpl classes
					for Zebra and for Lucene. The DEF-XWS Eprints application
					has indexes for both engines, therefore similar searches 
					may be compared.
					</li>
					<li>Sample search for Zebra: metal
					</li>
					<li>Sample search for Lucene: description:metal
					</li>
				</ul>
				<p><img src="images/fgs-arch-indexing.png"/></p>
				<ul>
					<li>Objects in the Fedora repository are exported
					in FOXML format, transformed into an appropriate 
					document format by the indexing stylesheet, and
					indexed by the engine in question. The XML datastreams
					are indexed as decided in the stylesheet. 
					One managed or external datastream may be indexed 
					per FedoraObject (which one is configurable), 
					assuming that they contain the same text in different
					mimetypes.
					Only Active FedoraObjects are indexed, 
					not Inactive nor Deleted ones,
					not bDefs, not bMechs.
					</li>
					<li>The following updateIndex actions are available:
					<ul>
						<li><b>createEmpty</b> - creating or emptying the index.
						For a new index, you have to run createEmpty once, before
						you can run the other actions.</li>
						<li><b>fromFoxmlFiles ( filePath )</b> - indexing FOXML records;
						filePath may be null, in which case the configured
						Fedora Object Directory is used, so that the whole 
						of the Fedora registry is indexed.</li>
						<li><b>fromPid ( PID )</b> - indexing one FOXML record,
						as exported by Fedora API-M; in case a previous
						index document with the same PID exists, it is first deleted.
						This is the incremental update operation that shall be called after 
						all of Fedora's API-M operations that modifies a FedoraObject.</li>
						<li><b>deletePid ( PID )</b> - deleting one index document.</li>
					</ul>
					</li>
				</ul>
				<p>The latest development adds the possibility to index
				many repositories in one or more indexes in parallel, as illustrated here:</p>
				<p><img src="images/fgs-manytomany.png"/></p>
				<p>
				<p>The SOAP service operations are deployed with the .war file and 
				<a href="services/FgsOperations?wsdl">the .wsdl file is available here.</a></p>

			<a name="multilingual"><h3>Multilingual Configuration</h3></a>
				<p>Luis Zorita had this problem and solved it 
				 (his mail to fedora-users on 24 August 2006):</p>
				<q>Hello Gert:
				I have solved this multilingual problem adding the attribute 
				URIEncoding=&quot;UTF-8&quot; to 
				/jakarta-tomcat-5.0.28/conf/server.xml 
				and to /jakarta-tomcat-5.0.28/conf/server_fedoraTemplate.xml
				Now I can search special Spanish characters like &quot;&ntilde;&quot;,
				&quot;&iacute;&quot; etc. with fedoragsearch.
				Luis</q>
  <div id="footer">
    <div id="copyright">
      Copyright &#xA9; 2006 Technical University of Denmark, Fedora Project
    </div>

    <div id="lastModified">
      Last Modified <script type="text/javascript">
      //<![CDATA[
            var cvsDate = "$Date$";
            var parts = cvsDate.split(" ");
            var modifiedDate = parts[1];
            document.write(modifiedDate);
      //]]>
      </script>
		by Gert Schmeltz Pedersen
    </div>
  </div>
		</body>
	</html>